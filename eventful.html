<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Park-Place</title>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/parsley.js/2.7.2/parsley.min.js"></script>
    <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/parsley.js/2.7.2/parsley.js"></script>-->
    <!-- <script src="assets/javascript/jquery.collapser.js">
    </script> -->
    <!-- <script href="assets/javascript/parsley.min.js"></script> -->
    <link rel="stylesheet" type="text/css" href="assets/css/parsley.css">
</head>

<body>
    <div class="panel panel-default">
        <div class="panel-body">
            <form class="form" id="form" data-parsley-validate="">
                <label for="location">Location</label>
                <input type="text" class="form-control" id="location" data-parsley-required="true">
                <label for="keyword">Keyword</label>
                <input type="text" class="form-control" id="keyword">
                <label for="event">Type of Event</label>
                <input type="text" class="form-control" id="event">
                <input id="addInfo" type="submit" value="Submit">
            </form>
        </div>
        <div class="panel panel-default" id="eventInfo"></div>
    </div>
    <script type="text/javascript" src="http://api.eventful.com/js/api"></script>
    <script type="text/javascript">
    $(document).ready(function() {
        $("#form").on("submit", function(event) {
            event.preventDefault();
            $("#eventInfo").empty();
            if ($(this).parsley().isValid()) {
                displayEvent();
                $(".form-control").val('');
                /*$(".description").collapser({
                    mode: 'words',
                    truncate: 20
                });*/
            }
        });
    });

    function displayEvent() {

        var location = $("#location").val().trim();
        var keyword = $("#keyword").val().trim();
        var event = $("#event").val().trim();

        var oArgs = {

            app_key: "N78vd3fpJCDPZCB7",

            q: event,

            where: location,

            date: "This Week",

            category: keyword,

            page_size: 10,

            sort_order: "relevance",

        };

        EVDB.API.call("/events/search", oArgs, function(oData) {

            // Note: this relies on the custom toString() methods below
            console.log(oData);
            Object.prototype.toString = function() {
                var s = "{\n";
                for (var x in this) {
                    s += "\t" + x + ": " + this[x].toString() + "\n";
                }
                s += "}";
                return s;
            }
            var results = oData.events.event;
            for (var i = 0; i < results.length; i++) {
                var eventDiv = $("<div class = 'eventList panel-body'>");
                var lat = results[i].latitude;
                var long = results[i].longitude;
                var title = results[i].title;
                var time = results[i].start_time;
                var venue = results[i].venue_name;
                var city = results[i].city_name;
                var state = results[i].region_abbr;
                var address = results[i].venue_address;
                var url = results[i].url;
                var description;
                var image;
                if (results[i].image !== null) {
                    image = results[i].image.medium.url;
                } else {
                    image = "assets/images/event.png";
                };
                if (results[i].description !== null) {
                    description = results[i].description;
                } else {
                    description = "Not Provided";
                }


                var titleP = $("<div class = 'row title'>").text("Event: " + title);
                var descriptionP = $("<div class = 'row description'>").text("Description: " + description);
                var venueP = $("<div class = 'row venue'>").text("Venue: " + venue);
                var addressP = $("<div class = 'row address'>").text("Address: " + address);
                var cityStateP = $("<div class = 'row cityState'>").text("City/State: " + city + ", " + state);
                var timeP = $("<div class = 'row time'>").text("Time: " + time);
                var urlP = $("<div class = 'row url'>").html("<a href='" + url + "' target='_blank'> Tickets </a>");
                var imageP = $("<div class = 'row image'>").html("<img src='" + image + "'>");

                // eventDiv.append(thumb);
                eventDiv.append(imageP);
                eventDiv.append(titleP);
                eventDiv.append(descriptionP);
                eventDiv.append(venueP);
                eventDiv.append(addressP);
                eventDiv.append(cityStateP);
                eventDiv.append(timeP);
                eventDiv.append(urlP);

                $("#eventInfo").append(eventDiv);
            }

        });


    }
    </script>
</body>

</html>
